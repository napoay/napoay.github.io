---
layout: post
title:  "KNN分类模型"
date:   2020-02-16 23:07:39 +0800
categories: cs ml
tag: machine learning
---


## K-近邻算法(KNN)
KNN是用于分类和回归的最简单模型，可用于二元分类、多元分类以及多标签分类任务。  


假设有以下已知数据:  

身高(cm)      | 体重(kg)        |  标签  
-|-|-
158 | 64 | 男性 |
170 | 66 | 男性 |
183 | 84 | 男性 |
191 | 80 | 男性 |
155 | 49 | 女性 |
163 | 59 | 女性 |
180 | 67 | 女性 |
158 | 54 | 女性 |
178 | 77 | 女性 |

使用matplotlib绘制散点图将训练数据可视化。


```python
import numpy as np
import matplotlib.pyplot as plt

X_train = np.array([
    [158, 64],
    [170, 86],
    [183, 84],
    [191, 80],
    [155, 49],
    [163, 59],
    [180, 67],
    [158, 54],
    [178, 77]
    ]
)

y_train = ['male', 'male', 'male', 'male', 'female', 
           'female', 'female', 'female','female']

plt.figure()
plt.title("Human Heights and Weights by Sex")
plt.xlabel("Height in cm")
plt.ylabel("Height in kg")

for i, x in enumerate(X_train):
    plt.scatter(x[0], x[1], c='k', marker='x' if y_train[i] == 'male' else 'D')

plt.grid(True)
plt.show()
```

<figure>
<a><img src="{{site.url}}/images/5.png"></a>
</figure>


假设待预测对象的身高为155cm，体重为70kg，预测其性别。


```python
x = np.array([[155,70]])

distances = np.sqrt(np.sum( (X_train - x) ** 2, axis =1 ))
print("待预测点与训练集的距离:\n%s\n" % distances)
nearest_neighbor_indices = distances.argsort()[:3]
print("最近的点的位置:%s\n" %nearest_neighbor_indices)
nearest_neighbor_genders = np.take(y_train,nearest_neighbor_indices)
print("最近的性别: %s\n" %nearest_neighbor_genders)
```

    待预测点与训练集的距离:
    [ 6.70820393 21.9317122  31.30495168 37.36308338 21.         13.60147051
     25.17935662 16.2788206  24.04163056]
    
    最近的点的位置:[0 5 7]
    
    最近的性别: ['male' 'female' 'female']
    



```python
from collections import Counter
b = Counter(np.take(y_train, distances.argsort()[:3]))
print("性别预测结果: %s" %b.most_common(1)[0][0])
```

    性别预测结果: female


## scikit-learn类库实现KNN分类器


```python
from sklearn.preprocessing import LabelBinarizer
from sklearn.neighbors import KNeighborsClassifier

lb = LabelBinarizer()

y_trained_binarized = lb.fit_transform(y_train)
print(y_trained_binarized)

K = 3

clf = KNeighborsClassifier(n_neighbors=K)
clf.fit(X_train, y_trained_binarized.reshape(-1))
prediction_binarized = clf.predict(np.array([155,70]).reshape(1,-1))[0]
predicted_label = lb.inverse_transform(prediction_binarized)
predicted_label[0]
```

    [[1]
     [1]
     [1]
     [1]
     [0]
     [0]
     [0]
     [0]
     [0]]





    'female'



对测试集进行预测并计算准确率   
<br/>

身高(cm)      | 体重(kg)        |  标签  
-|-|-
168 | 65 | 男性 |
170 | 61 | 男性 |
160 | 52 | 女性 |
169 | 67 | 女性 |


```python
X_test = np.array(
    [
        [168, 65],
        [180, 96],
        [160, 52],
        [169, 67]
    ]
)

y_test = ['male', 'male', 'female', 'female']

y_test_binarized = lb.transform(y_test)
print('y_test_binarized labels:\n %s' %y_test_binarized.T[0])

predictions_binarized = clf.predict(X_test)
print('predictions predictions: %s' %predictions_binarized)

print('Predicted labels:%s' % lb.inverse_transform(predictions_binarized))
```

    y_test_binarized labels:
     [1 1 0 0]
    predictions predictions: [0 1 0 0]
    Predicted labels:['female' 'male' 'female' 'female']


准确率:


```python
from sklearn.metrics import accuracy_score
print('Accuracy: %s' % accuracy_score(y_test_binarized,predictions_binarized))
```

    Accuracy: 0.75


精确率:


```python
from sklearn.metrics import precision_score
print('Precision: %s' %precision_score(y_test_binarized, predictions_binarized))
```

    Precision: 1.0


召回率:


```python
from sklearn.metrics import recall_score
print('Recall: %s' %recall_score(y_test_binarized, predictions_binarized))
```

    Recall: 0.5


F1值:


```python
from sklearn.metrics import f1_score
print('F1 score: %s' %f1_score(y_test_binarized, predictions_binarized))
```

    F1 score: 0.6666666666666666


MCC值(马修斯相关系数):


```python
from sklearn.metrics import matthews_corrcoef
print('Matthnews correlation coefficient: %s' %matthews_corrcoef(y_test_binarized, predictions_binarized))
```

    Matthnews correlation coefficient: 0.5773502691896258


生成报告:


```python
from sklearn.metrics import classification_report
print('classification_report:\n %s' %classification_report(y_test_binarized, predictions_binarized,
                                                        target_names=['male'], labels = [1]))
```

    classification_report:
                   precision    recall  f1-score   support
    
            male       1.00      0.50      0.67         2
    
       micro avg       1.00      0.50      0.67         2
       macro avg       1.00      0.50      0.67         2
    weighted avg       1.00      0.50      0.67         2
    

